# 쿠키 세션 웹 스토리지

HTTP 프로토콜의 한계를 보완하기 위해 쿠키 또는 세션을 사용한다.

기본적으로 HTTP 프로토콜 환경은 비연결지향(connecntionless), 무상태(stateless)한 특성을 가지기 때문에 요청만으로 서버는 클라이언트를 구별할 수 없다.

> 비연결지향(connectionless)
>
> HTTP는 먼저 클라이언트가 요청을 서버에 보내면, 서버는 클라이언트에게 요청에 맞는 응답을 보내고 TCP/IP 연결을 끊는 특성이다.
>
> HTTP 1.1에서는 헤더에 keep-alive라는 값을 줘서 연결을 재활용한다.

> 무상태
>
> 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보를 유지하지 않는 특성이다.

## 쿠키

- 서버가 클라이언트에 전송하는 작은 데이터 조각이다.

  - Respnes Header에 Set-Cookie 속성을 사용하면 클라이언트에 쿠키를 만들 수 있다.
  - 이름, 값, 만료일(저장 기간 설정), 경로 정보로 구성되어 있다.
  - 만료기간을 설정안하면 세션쿠키, 설정하면 반영구적(만료기간까지)으로 남아있다.
  - 하나의 쿠키값은 4KB(4096byte)까지 저장이 가능하다.

- 브라우저는 그 데이터 조각들을 저장해 놓앗다가, 동일한 서버에 재 요청 시 데이터를 함께 전송한다.

  - 클라이언트에 300개까지 쿠키 저장 가능
  - 하나의 도메인당 20개의 값만 가질 수 있다.
  - 쿠키는 사용자가 따로 요청하지 않아도 부라우저가 Request 시에 Request Header를 넣어서 자동으로 서버에 전송한다.

- 쿠키는 두 요청이 동일한 브라우저에서 들어왔는지 아닌지를 판단할 때 주로 사용한다. Ex) 로그인 상태 유지
- **주 목적**
  - 세션관리(Session management)
    - 서버에 저장해야할 로그인 장바구니 게임 스코어등의 정보관리
  - 개인화(Presonalization)
    - 사용자 선호, 테마등의 세팅
  - 트래킹(Tracking)
    - 사용자 행동을 기록하고 분석하는 용도

## 세션

- 사용자 정보를 파일 브라우저에 저장하는 쿠키와 달리 세션은 **서버 측에서 관리**한다.
- 서버에서 클라이언트를 구분하기 위해 세션 ID를 부여하며, 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지한다.
- 서버가 허용하는 한 용량 제한이 없다.
- 접속 시간에 제한을 두어 일정 시간 응답이 없다면 정보가 유지되지 않게 설정 가능하다.
- 데이터를 서버에 두기 때문에 쿠키보다 보안에 좋지만, 사용자가 많아질수록 서버 메모리를 많이 차지하게 된다.

### 쿠키와 세션의 차이점

- 데이터 저장 위치
  - 쿠키: 클라이언트
  - 세션 : 서버
- 저장형식
  - 쿠키 : text
  - 세션 : Object
- 사용하는 리소스
  - 쿠키 : 클라이언트 리소스
  - 세션 : 서버 리소스
- 보안
  - 저장 위치 때문에 쿠키는 스니핑에 당할 우려가 있지만 세션은 쿠키를 이용해 세션 아이디만 저장하고 서버에서 처리하기 때문에 보안성이 더 좋다.
  - 쿠키 < 세션
- 속도
  - 세션은 서버의 처리가 필요하기 때문에 쿠키 보다 속도가 느리다.
  - 쿠키 > 세션

## 웹 스토리지

- 클라이언트에 데이터를 저장할 수 있도록 HTML5부터 추가된 저장소
- 간단한 key-value 스토리지 형태
- 쿠키와 달리 자동 전송의 위험성이 없다.
- 오리진(도메인, 프로토콜, 포트) 단위로 접근이 제한되는 특성 덕분에 CSRF로 부터 안전
- 쿠키보다 큰 저장 용량 지원(모바일 2.5MB, 데스크탑 5~10MB)
- 서버가 HTTP 헤더를 통해 스토리지 객체를 조작할 수 없음(웹 스토리지 객체 조작은 JS내에서만 수행)
- 문자열 데이터 타입만 지원
- 로컬스토리지와 세션 스토리지가 있다. 같은 Storage 객체를 상속하기 때문에 메서드는 동일하다.

> 사이트 간 요청 위조 CSRF(Cross Site Request Forgery)
>
> **사이트 간 요청 위조**(또는 **크로스 사이트 요청 위조**는 웹사이트 취약점 공격의 하나로, 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위(수정, 삭제, 등록 등)를 특정 웹사이트에 요청하게 하는 공격을 말한다.

### 로컬스토리지 localStorage

- 사용자가 데이터를 지우지 않는 이상, 브라우저나 OS를 정료해도 계속 브라우저에 남아있다.
  - 동일한 브라우저를 사용할 때만 해당
  - JavaScript를 사용하거나 브라우저 캐시 또는 로컬 저장 데이터를 지워야만 사라진다.
- 지속적으로 필요한 데이터 저장 Ex)자동 로그인

- 객체 저장 가능

  - ```javascript
    const settings = {
      backgroundColor: '#fff',
      color: '#111',
      theme: 'light',
    };

    localStorage.setItem('settings', JSON.stringify(settings));

    let storedSettings = JSON.parse(localStorage.getItem('settings'));

    console.log(storedSettings);
    console.log(localStorage.getItem('settings'));
    // '{"backgroundColor":"#fff","color":"#111","theme":"light"}'
    ```

### 세션스토리지 sessionStorage

- 데이터가 오리진 뿐만 아니라 브라우저 탭에도 종속되기 때문에, 윈도우나 브라우저 탭을 닫을 경우 제거된다.
- 일시적으로 필요한 데이터 저장 Ex) 일회성 로그인 정보, 입력폼 저장등
- 데이터를 절대 서버로 전송하지 않습니다.
- 저장 공간이 쿠키보다 큽니다. (최대 5MB)

## 쿠키 웹스토리지의 차이점

가장 큰 차이점은 HTTP 요청 헤더에 항상 포함되어 성능 저하의 원인이 되며 자동 전송의 위험성이 있었지만 웹스토리지는 필요한 경우에만 꺼내 쓰는 것이 가능하므로 자동전송의 위험성이 없고 오리진(도메인, 프로토콜, 포트) 단위로 접근이 제한되는 특성 때문에 CSRF로 부터 안전합니다.

쿠키는 최대 4KB 용량 제한되어 있지만 웹스로지는 5MB~10MB 크기 까지 저장할 수 있습니다.

쿠키는 서버와 브라우저에 정보를 저장하지만 웹스토리지는 브라우저에만 저장을 합니다.

쿠키는 만료기간이 설정되어 있지만 웹스토리지의 로컬스토리지를 사용하면 영구적으로 브라우저에 보관할 수 있습니다.

웹스토리지는 HTML5에서 생겼기 때문에 HTML5이하에서는 사용할 수 없는 단점이 있습니다.

#### Reference

https://developer.mozilla.org/ko/

https://doqtqu.tistory.com/306

https://www.javascripttutorial.net/web-apis/javascript-localstorage/
