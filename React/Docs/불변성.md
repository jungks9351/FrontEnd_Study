# React 불변성

불변성을 유지시키는 방법은 알고 있었지만 이유에 대해서 정리가 미흡했던거 같아 정리를 합니다.

## 불변성

불변성은 상태나 값을 변경하지 않는 것입니다.

자바스크립트에서 원시타입의 데이터는 불변성을 가지고 있습니다.

```js
let a = 1;
a = 2;
```

위 코드처럼 변수에 값을 재할당하면 'a'가 참조하고 있는 메모리의 값이 변경되는 것이 아니라 새로운 데이터 값인 '2'가 메모리에 새로 저장되고 그 주소 값이 'a'에 할당됩니다.

**원시 타입 값이 아닌 다른 참조형 값들(객체, 배열, 함수 등)은 이와는 다르게 동작합니다..**

```js
const obj = {
  a: 1,
};

obj.a = 2;
```

`obj` 의 내부 프로퍼티의 값을 변경했을 때 obj에서 참조하고 있는 'a'값은 변경되지 않고 값이 변경됩니다. 단, 'a'가 참조하고 있는 '1'의 주소 값은 변경됩니다.

이처럼 자바스크립트 객체는 가변한다. 리액트에서는 자바스크립트 객체가 가변하기 때문에 문제가 됩니다.

## 리액트 상태의 불변성

리액트는 Virtual DOM이 상태의 변화를 감지하여 리렌더링이 일어납니다.

리액트에서 불변성이 필요한 이유는 두가지입니다.

1. Virtual DOM이 상태가 변경됐는지 알기 위해

2. 값을 수정하면, 이전 상태와 바뀐 상태값이 동일해져서 비교할 수 없기 때문

리액트에서 리렌더링할 때 값 자체가 아니라 참조 값을 비교하므로 참조 값이 동일하면, 변경을 감지할 수 없습니다.

또한, 값을 수정하면 이전 상태와 바뀐 상태값이 동일해지기 때문에, 이전 상태와 현재 상태를 비교하여 렌더링할 수 없게 됩니다.

### 리액트 불변성 구현

1. assign 메서드 사용
2. spread 연산자 사용
3. 라이브러리 사용이다.

#### 1. assign

```js
const obj = {
  a: 1,
};

Object.assign({}, obj, {
  b: 2,
});
```

#### 2. spread

```js
const obj = { ...obj, b: 2 };
```

#### 3. 라이브러리

위 두 가지 방식을 사용하면 얕은 복사가 된다. 그러므로 객체 안의 객체가 있으면 그 안의 객체도 복사해주어야 합니다.

하지만 무분별하게 깊은 복사를 사용하는 것은 다음과 같은 이유로 문제가 될 수 있습니다.

- 깊은 복사는 성능이 저하 요인이 될 수 있습니다.
- 리액트에서 변경되지 않은 객체도 변경되었다고 감지하여 모든 것을 리렌더링할 수 있습니다.

이를 편하게 하고자 [immer.js](https://github.com/immerjs/immer)와 같은 라이브러리를 사용하여 쉽게 불변성을 관리할 수 있습니다.

## 정리

리액트의 불변성을 유지시켜줘야 Virtual DOM에서 상태 변화 원본을 유지하고 사본의 변화를 감지하기 위해서 필요합니다. 상태를 직접 변경하게 되면 상태 값은 변하지만 참조값은 바뀌지 않으므로 렌더링이 일어나지 않습니다. 불변성을 지키지 않으면 Virtual DOM이 제대로 작동을 하지 않아 예기치 않은 사이드 이펙트를 발생시킬수 있는 것입니다. 그러기 때문에 리액트에서 불변성을 유지시켜야 합니다.

## 참고

- https://bohyeon-n.github.io/deploy/react/react_immutable.html
